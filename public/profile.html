<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Airvibe | Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { main: ['Plus Jakarta Sans', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] },
                    colors: { bg: '#020617', glass: 'rgba(30, 41, 59, 0.4)', primary: '#6366f1' }
                }
            }
        }
    </script>

    <style>
        body { background: #020617; color: white; font-family: 'Plus Jakarta Sans', sans-serif; overflow: hidden; }
        
        /* FX */
        .orb { position: fixed; border-radius: 50%; filter: blur(100px); opacity: 0.2; z-index: -1; }
        .orb-1 { top: -10%; left: -10%; width: 40vw; height: 40vw; background: #6366f1; animation: float 10s infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(20px); } }

        /* Components */
        .glass-panel { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.08); }
        
        /* Sidebar Link Active State */
        .nav-link.active { background: rgba(99, 102, 241, 0.15); border-right: 3px solid #6366f1; color: white; }
        .nav-link:hover:not(.active) { background: rgba(255,255,255,0.05); }

        /* Toggle Switch */
        .toggle-checkbox:checked { right: 0; border-color: #6366f1; }
        .toggle-checkbox:checked + .toggle-label { background-color: #6366f1; }
        
        /* Table */
        td, th { padding: 16px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        tr:last-child td { border-bottom: none; }
    </style>
</head>
<body class="flex h-screen">

    <div class="orb orb-1"></div>

    <aside class="w-64 glass-panel border-r border-white/5 flex flex-col z-20">
        <div class="h-20 flex items-center px-8 border-b border-white/5">
            <div class="text-xl font-black tracking-tighter">AIR<span class="text-indigo-500">VIBE</span></div>
        </div>

        <nav class="flex-1 py-6 space-y-1" id="sidebar-nav">
            </nav>

        <div class="p-4 border-t border-white/5">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-indigo-500 to-purple-500 p-[2px]">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=King" class="rounded-full bg-black">
                </div>
                <div>
                    <div class="text-sm font-bold" id="user-name-disp">Loading...</div>
                    <div class="text-[10px] text-gray-400 uppercase tracking-wider" id="user-plan-disp">FREE</div>
                </div>
            </div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col relative overflow-hidden">
        
        <header class="h-20 border-b border-white/5 flex items-center justify-between px-8 bg-black/20 backdrop-blur">
            <h2 class="text-xl font-bold" id="page-title">Overview</h2>
            <div class="flex gap-4">
                <a href="/profile" class="px-4 py-2 rounded-lg border border-white/10 text-xs font-bold hover:bg-white/5 transition">VIEW PROFILE</a>
                <a href="/studio" class="px-4 py-2 rounded-lg bg-indigo-600 text-white text-xs font-bold hover:bg-indigo-500 transition shadow-lg shadow-indigo-500/20">OPEN STUDIO</a>
            </div>
        </header>

        <div class="flex-1 overflow-y-auto p-8" id="content-area">
            </div>

    </main>

    <template id="tpl-host">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="glass-panel p-6 rounded-2xl">
                <div class="text-xs text-gray-400 font-bold mb-2">TOTAL REVENUE</div>
                <div class="text-3xl font-mono font-bold text-green-400">‚Ç¶<span id="stat-rev">0</span></div>
            </div>
            <div class="glass-panel p-6 rounded-2xl">
                <div class="text-xs text-gray-400 font-bold mb-2">PEAK LISTENERS</div>
                <div class="text-3xl font-mono font-bold text-white"><span id="stat-listeners">0</span></div>
            </div>
            <div class="glass-panel p-6 rounded-2xl">
                <div class="text-xs text-gray-400 font-bold mb-2">STREAM TIME</div>
                <div class="text-3xl font-mono font-bold text-indigo-400">45<span class="text-sm">h</span> 20<span class="text-sm">m</span></div>
            </div>
        </div>

        <div class="glass-panel rounded-2xl p-6 mb-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold">üéôÔ∏è The Vault (Recordings)</h3>
                <span class="text-xs px-2 py-1 bg-indigo-500/20 text-indigo-300 rounded border border-indigo-500/30">PRO FEATURE</span>
            </div>
            <table class="w-full text-left text-sm text-gray-400">
                <thead><tr><th>TITLE</th><th>DATE</th><th>SIZE</th><th>ACTION</th></tr></thead>
                <tbody id="vault-list"></tbody>
            </table>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="glass-panel p-6 rounded-2xl">
                <h3 class="font-bold mb-4">ü§ñ Noise Assassin AI</h3>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-400">Remove background noise from streams.</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" class="sr-only peer" checked>
                        <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                    </label>
                </div>
            </div>
        </div>
    </template>

    <template id="tpl-business">
        <div class="glass-panel p-6 rounded-2xl mb-8 border border-emerald-500/30">
            <div class="flex justify-between items-center">
                <div>
                    <h3 class="text-xl font-bold text-emerald-400">Empire Control Center</h3>
                    <p class="text-sm text-gray-400">Manage your station brand and team.</p>
                </div>
                <button class="px-4 py-2 bg-emerald-600 text-black font-bold rounded-lg text-sm">Download Report</button>
            </div>
        </div>

        <div class="glass-panel p-6 rounded-2xl mb-8">
            <h3 class="font-bold mb-4">üì¢ Ad Injection Manager</h3>
            <div class="border-2 border-dashed border-white/10 rounded-xl p-8 text-center hover:border-emerald-500/50 transition cursor-pointer">
                <div class="text-2xl mb-2">üìÇ</div>
                <div class="text-sm text-gray-400">Upload MP3 Audio Ads here.<br>We will auto-insert them every 15 mins.</div>
            </div>
        </div>

        <div class="glass-panel p-6 rounded-2xl">
            <h3 class="font-bold mb-4">üë• Team Access</h3>
            <div id="team-list" class="space-y-3"></div>
        </div>
    </template>

    <template id="tpl-listener">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="glass-panel p-6 rounded-2xl flex items-center justify-between">
                <div>
                    <h3 class="font-bold text-purple-400">üëª Ghost Mode</h3>
                    <p class="text-xs text-gray-400">Listen without appearing in user lists.</p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" class="sr-only peer">
                    <div class="w-11 h-6 bg-gray-700 rounded-full peer peer-checked:bg-purple-600 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full"></div>
                </label>
            </div>
            
            <div class="glass-panel p-6 rounded-2xl">
                <h3 class="font-bold text-yellow-400">üíæ Offline Library</h3>
                <div class="text-xs text-gray-400 mt-1">12 Streams Downloaded (450MB Used)</div>
            </div>
        </div>

        <div class="glass-panel p-6 rounded-2xl">
            <h3 class="font-bold mb-4">‚ù§Ô∏è Favorite Stations</h3>
            <div class="flex gap-4">
                <div class="w-24 h-24 bg-gray-800 rounded-lg"></div>
                <div class="w-24 h-24 bg-gray-800 rounded-lg"></div>
                <div class="w-24 h-24 bg-gray-800 rounded-lg border-2 border-dashed border-white/10 flex items-center justify-center text-2xl">+</div>
            </div>
        </div>
    </template>

    <script>
        // MOCK USER STATE (Replace with API Call)
        // Change 'role' to 'listener', 'host', or 'business' to see different dashboards
        const currentUser = { 
            name: "Tomiwa", 
            role: "host", 
            plan: "Creator Pro" 
        };

        // NAV ITEMS CONFIG
        const navItems = {
            listener: [
                { icon: "üè†", label: "Home", active: true },
                { icon: "‚ù§Ô∏è", label: "Favorites" },
                { icon: "üíæ", label: "Downloads" },
                { icon: "‚öôÔ∏è", label: "Settings" }
            ],
            host: [
                { icon: "üìä", label: "Overview", active: true },
                { icon: "üéôÔ∏è", label: "My Studio" },
                { icon: "üìÇ", label: "The Vault" },
                { icon: "üí∞", label: "Monetization" }
            ],
            business: [
                { icon: "üè¢", label: "HQ Overview", active: true },
                { icon: "üì¢", label: "Ad Manager" },
                { icon: "üë•", label: "Team" },
                { icon: "üîå", label: "API Keys" }
            ]
        };

        function init() {
            // 1. Set User Info
            document.getElementById('user-name-disp').innerText = currentUser.name;
            document.getElementById('user-plan-disp').innerText = currentUser.plan;

            // 2. Build Sidebar
            const nav = document.getElementById('sidebar-nav');
            navItems[currentUser.role].forEach(item => {
                nav.innerHTML += `
                    <a href="#" class="nav-link flex items-center px-8 py-3 text-sm font-medium text-gray-400 transition ${item.active ? 'active' : ''}">
                        <span class="mr-4 text-lg">${item.icon}</span> ${item.label}
                    </a>
                `;
            });

            // 3. Load Content Template
            const templateId = `tpl-${currentUser.role}`;
            const template = document.getElementById(templateId);
            const clone = template.content.cloneNode(true);
            document.getElementById('content-area').appendChild(clone);

            // 4. Fetch & Fill Data (Based on Role)
            if(currentUser.role === 'host') loadHostData();
            if(currentUser.role === 'business') loadBusinessData();
        }

        async function loadHostData() {
            // Fetch Stats
            const resStats = await fetch('/api/dashboard/stats');
            const dataStats = await resStats.json();
            
            // Animate Numbers
            document.getElementById('stat-rev').innerText = dataStats.stats.total_revenue.toLocaleString();
            document.getElementById('stat-listeners').innerText = dataStats.stats.listeners_peak.toLocaleString();

            // Fetch Vault
            const resVault = await fetch('/api/dashboard/vault');
            const vaultData = await resVault.json();
            const list = document.getElementById('vault-list');
            
            vaultData.forEach(file => {
                list.innerHTML += `
                    <tr class="hover:bg-white/5 transition">
                        <td class="font-bold text-white">${file.title}</td>
                        <td>${file.date}</td>
                        <td>${file.size}</td>
                        <td><button class="text-indigo-400 hover:text-white hover:underline">Download</button></td>
                    </tr>
                `;
            });
        }

        async function loadBusinessData() {
            const res = await fetch('/api/dashboard/team');
            const team = await res.json();
            const container = document.getElementById('team-list');
            
            team.forEach(member => {
                container.innerHTML += `
                    <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-emerald-900 flex items-center justify-center font-bold text-emerald-400">${member.name[0]}</div>
                            <div>
                                <div class="text-sm font-bold text-white">${member.name}</div>
                                <div class="text-[10px] text-gray-500 uppercase">${member.role}</div>
                            </div>
                        </div>
                        <span class="text-xs text-green-400">‚óè ${member.status}</span>
                    </div>
                `;
            });
        }

        init();
    </script>
</body>
</html>